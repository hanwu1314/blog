---
title: æ³¨å†ŒåŠŸèƒ½
icon: bijiben
category: "php"
order: 3
---
## ğŸ“‘è¡¨ç»“æ„
å·²åˆ›å»ºçš„ä¸¤ä¸ªè¡¨ç»“æ„å¦‚ä¸‹
![](assets/03-01.webp)

## ğŸ“æ³¨å†Œæµç¨‹å›¾

![](assets/03-02.webp)

## ğŸ”¨Controllerå±‚

> å‚è€ƒé“¾æ¥
> [è¯·æ±‚-è¾“å…¥å˜é‡](https://www.kancloud.cn/manual/thinkphp5/118044)
> [è¯·æ±‚ç±»å‹](https://www.kancloud.cn/manual/thinkphp5/118045)

`home/controller/Index.php`

```php
    /**
     * æ³¨å†Œ
     */
    public function register()
    {
        if ($this->request->isPost()) {
            $mobile = $this->request->param('mobile', '', 'trim');
            halt($mobile);
        }
        return $this->fetch();
    }
```

- åˆ¤æ–­æ˜¯å¦æœ‰postè¯·æ±‚
  - æœ‰çš„è¯åœ¨è·å–postå˜é‡æ—¶æ·»åŠ è§„åˆ™
    - è¿‡æ»¤å·¦å³ç©ºæ ¼
- `halt` å‡½æ•°-è°ƒè¯•å˜é‡å¹¶ä¸”ä¸­æ–­è¾“å‡º

## ğŸ”¨Model

```shell
php think make:model common/business/Business
```

```shell
php think make:model common/business/Source
```

æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ä¼šåœ¨`application/common/model`ä¸‹åˆ›å»ºå¯¹åº”æ–‡ä»¶

`business/Business.php`

```php
<?php

namespace app\common\model\business;

use think\Model;

class Business extends Model
{
    /** æŒ‡å®šçš„æ•°æ®è¡¨ */
    protected $name = 'business';
    /** å¼€å¯è‡ªåŠ¨å†™å…¥æ—¶é—´æˆ³ */
    protected $autoWriteTimestamp = true;
    /** å®šä¹‰æ—¶é—´æˆ³å­—æ®µå */
    protected $createTime = 'createtime';
    /** æ›´æ–°æ—¶é—´ */
    protected $updateTime = false;
}

```

æ¨¡å‹ä¼šè‡ªåŠ¨å¯¹åº”æ•°æ®è¡¨ï¼Œæ¨¡å‹ç±»çš„å‘½åè§„åˆ™æ˜¯é™¤å»è¡¨å‰ç¼€çš„æ•°æ®è¡¨åç§°ï¼Œé‡‡ç”¨é©¼å³°æ³•å‘½åï¼Œå¹¶ä¸”é¦–å­—æ¯å¤§å†™

- å¼€å¯æ—¶é—´æˆ³åœ¨å•ç‹¬çš„æ¨¡å‹ç±»é‡Œé¢è®¾ç½®
  - [æ—¶é—´æˆ³ Â· ThinkPHP5.0å®Œå…¨å¼€å‘æ‰‹å†Œ Â· çœ‹äº‘ (kancloud.cn)](https://www.kancloud.cn/manual/thinkphp5/138668)
- å…³é—­æ›´æ–°æ—¶é—´

### åˆå§‹åŒ–æ¨¡å‹

æ¨¡å‹åŒæ ·æ”¯æŒåˆå§‹åŒ–ï¼Œä¸æ§åˆ¶å™¨çš„åˆå§‹åŒ–ä¸åŒçš„æ˜¯ï¼Œæ¨¡å‹çš„åˆå§‹åŒ–æ˜¯é‡å†™`Model`çš„`initialize`ï¼Œå…·ä½“å¦‚ä¸‹

`application\home\controller\Index.php`

```php
class Index extends Controller
{
    /** ç”¨æˆ·æ¨¡å‹ */
    protected $BusinessModel = null;
    
    public function _initialize()    {
        $this->BusinessModel = model('business.Business');
    }
    // ...
}
```

ä»¥ä¸Šä»£ç æ‰§è¡Œäº†æ„é€ å‡½æ•°è°ƒç”¨äº†åŠ©æ‰‹å‡½æ•°ä¸­çš„modelæ–¹æ³•,å°†modelåç§°(å‘½åç©ºé—´.ç±»å)ä¼ å…¥è·å¾—model

[æ¨¡å‹åˆå§‹åŒ– Â· ThinkPHP5.0å®Œå…¨å¼€å‘æ‰‹å†Œ Â· çœ‹äº‘ (kancloud.cn)](https://www.kancloud.cn/manual/thinkphp5/177529)



`business/Source.php`

```php
<?php

namespace app\common\model\business;

use think\Model;

class Source extends Model
{
    protected $name = 'business_source';
}

```

## ğŸ”¨å·¥å…·å‡½æ•°-ç”Ÿæˆéšæœºå­—ç¬¦ä¸²

åœ¨`application/common.php`ä¸­æœ€åº•éƒ¨æ·»åŠ å·¥å…·å‡½æ•°
::: details
```php
/*
!==== ä¸‹é¢çš„å‡½æ•°éƒ½æ˜¯è‡ªå·±æ·»åŠ  ====
*/

if (!function_exists('build_ranstr')) {
    /**
     * è·å¾—éšæœºå­—ç¬¦ä¸²
     * @param   int     $len        éœ€è¦çš„é•¿åº¦
     * @param   bool    $special    æ˜¯å¦éœ€è¦ç‰¹æ®Šç¬¦å·
     * @return  string  è¿”å›éšæœºå­—ç¬¦ä¸²
     */
    function build_ranstr($len = 8, $special = false)
    {
        $chars = range('a', 'z');
        $chars = array_merge($chars, range('A', 'Z'));
        $chars = array_merge($chars, range(0, 9));

        if ($special) {
            $chars = array_merge($chars, array(
                "!", "@", "#", "$", "?", "|", "{", "/", ":", ";",
                "%", "^", "&", "*", "(", ")", "-", "_", "[", "]",
                "}", "<", ">", "~", "+", "=", ",", "."
            ));
        }

        $charsLen = count($chars) - 1;
        shuffle($chars); //æ‰“ä¹±æ•°ç»„é¡ºåº
        $str = ''; // ç”¨æ¥æ‹¼æ¥çš„
        for ($i = 0; $i < $len; $i++) {
            $str .= $chars[mt_rand(0, $charsLen)];    //éšæœºå–å‡ºä¸€ä½
        }
        return $str;
    }
}
```
:::
## ğŸ”¨ç”¨æˆ·éªŒè¯å™¨

ThinkPHP5.0éªŒè¯ä½¿ç”¨ç‹¬ç«‹çš„\think\Validateç±»æˆ–è€…éªŒè¯å™¨è¿›è¡ŒéªŒè¯
ä½¿ç”¨åŠ©æ‰‹å‡½æ•°å®ä¾‹åŒ–éªŒè¯å™¨
[éªŒè¯å™¨ Â· ThinkPHP5.0å®Œå…¨å¼€å‘æ‰‹å†Œ Â· çœ‹äº‘ (kancloud.cn)](https://www.kancloud.cn/manual/thinkphp5/129352)
å¯ä»¥åœ¨å®šä¹‰éªŒè¯è§„åˆ™çš„æ—¶å€™å®šä¹‰åœºæ™¯ï¼Œå¹¶ä¸”éªŒè¯ä¸åŒåœºæ™¯çš„æ•°æ®
[éªŒè¯åœºæ™¯ Â· ThinkPHP5.0å®Œå…¨å¼€å‘æ‰‹å†Œ Â· çœ‹äº‘ (kancloud.cn)](https://www.kancloud.cn/manual/thinkphp5/129322)



`application\common\validate\business\Business.php`
::: details
```php
<?php

namespace app\common\validate\business;

use think\Validate;

/**
 * ç”¨æˆ·éªŒè¯å™¨
 */
class Business extends Validate
{
    /**
     * éªŒè¯è§„åˆ™
     */
    protected $rule = [
        'mobile'   => ['require', 'number', 'unique:business', 'regex:/(^1[3|4|5|7|8][0-9]{9}$)/'],
        'money' => ['number', '>=:0'],
        'auth' => ['number', 'in:0,1'],
        'deal' => ['number', 'in:0,1'],
        'nickname' => ['require'],
        'email' => ['email', 'require'],
    ];

    /**
     * é”™è¯¯æç¤ºä¿¡æ¯
     */
    protected $message = [
        'mobile.require' => 'æ‰‹æœºå·å¿…å¡«',
        'mobile.unique' => 'æ‰‹æœºå·å·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥',
        'password.require'  => 'å¯†ç å¿…å¡«',
        'salt.require'      => 'å¯†ç ç›å¿…å¡«',
        'money.number'      => 'ä½™é¢å¿…é¡»æ˜¯æ•°å­—ç±»å‹',
        'money.>='      => 'ä½™é¢å¿…é¡»å¤§äºç­‰äº0å…ƒ',
        'auth.number'      => 'è®¤è¯çŠ¶æ€çš„ç±»å‹æœ‰è¯¯',
        'auth.in'      => 'è®¤è¯çŠ¶æ€çš„å€¼æœ‰è¯¯',
        'deal.number'      => 'æˆäº¤çŠ¶æ€çš„ç±»å‹æœ‰è¯¯',
        'deal.in'      => 'æˆäº¤çŠ¶æ€çš„å€¼æœ‰è¯¯',
        'nickname.require' => 'æ˜µç§°å¿…å¡«',
        'email.require' => 'é‚®ç®±å¿…å¡«',
        'email.email' => 'é‚®ç®±æ ¼å¼é”™è¯¯'
    ];

    /**
     * éªŒè¯åœºæ™¯
     */
    protected $scene = [
        'register' => ['mobile', 'password', 'salt', 'money', 'auth', 'deal'],
        'profile' => ['nickname', 'email']
    ];
}

```
:::
## âœ¨å¤šè¯­è¨€æ”¯æŒ

`application/home/lang/zh-cn.php`

::: details

```php
<?php

return [
    'Keep login'                                             => 'ä¿æŒä¼šè¯',
    'Forgot password'                                        => 'å¿˜è®°å¯†ç ?',
    'Username'                                               => 'ç”¨æˆ·å',
    'User id'                                                => 'ä¼šå‘˜ID',
    'Nickname'                                               => 'æ˜µç§°',
    'Password'                                               => 'å¯†ç ',
    'Sign up'                                                => 'æ³¨ å†Œ',
    'Sign in'                                                => 'ç™» å½•',
    'Sign out'                                               => 'é€€ å‡º',
    'Guest'                                                  => 'æ¸¸å®¢',
    'Welcome'                                                => '%sï¼Œä½ å¥½ï¼',
    'Add'                                                    => 'æ·»åŠ ',
    'Edit'                                                   => 'ç¼–è¾‘',
    'Delete'                                                 => 'åˆ é™¤',
    'Move'                                                   => 'ç§»åŠ¨',
    'Name'                                                   => 'åç§°',
    'Status'                                                 => 'çŠ¶æ€',
    'Weigh'                                                  => 'æƒé‡',
    'Operate'                                                => 'æ“ä½œ',
    'Warning'                                                => 'æ¸©é¦¨æç¤º',
    'Default'                                                => 'é»˜è®¤',
    'Article'                                                => 'æ–‡ç« ',
    'Page'                                                   => 'å•é¡µ',
    'OK'                                                     => 'ç¡®å®š',
    'Cancel'                                                 => 'å–æ¶ˆ',
    'Loading'                                                => 'åŠ è½½ä¸­',
    'Money'                                                  => 'ä½™é¢',
    'Score'                                                  => 'ç§¯åˆ†',
    'More'                                                   => 'æ›´å¤š',
    'Normal'                                                 => 'æ­£å¸¸',
    'Hidden'                                                 => 'éšè—',
    'Submit'                                                 => 'æäº¤',
    'Reset'                                                  => 'é‡ç½®',
    'Execute'                                                => 'æ‰§è¡Œ',
    'Close'                                                  => 'å…³é—­',
    'Search'                                                 => 'æœç´¢',
    'Refresh'                                                => 'åˆ·æ–°',
    'First'                                                  => 'é¦–é¡µ',
    'Previous'                                               => 'ä¸Šä¸€é¡µ',
    'Next'                                                   => 'ä¸‹ä¸€é¡µ',
    'Last'                                                   => 'æœ«é¡µ',
    'None'                                                   => 'æ— ',
    'Online'                                                 => 'åœ¨çº¿',
    'Logout'                                                 => 'é€€å‡º',
    'Profile'                                                => 'ä¸ªäººèµ„æ–™',
    'Index'                                                  => 'é¦–é¡µ',
    'Hot'                                                    => 'çƒ­é—¨',
    'Recommend'                                              => 'æ¨è',
    'Dashboard'                                              => 'æ§åˆ¶å°',
    'Code'                                                   => 'ç¼–å·',
    'Message'                                                => 'å†…å®¹',
    'Line'                                                   => 'è¡Œå·',
    'File'                                                   => 'æ–‡ä»¶',
    'Menu'                                                   => 'èœå•',
    'Type'                                                   => 'ç±»å‹',
    'Title'                                                  => 'æ ‡é¢˜',
    'Content'                                                => 'å†…å®¹',
    'Apply'                                                  => 'åº”ç”¨',
    'Clear'                                                  => 'æ¸…ç©º',
    'Custom Range'                                           => 'è‡ªå®šä¹‰',
    'Today'                                                  => 'ä»Šå¤©',
    'Yesterday'                                              => 'æ˜¨å¤©',
    'Last 7 days'                                            => 'æœ€è¿‘7å¤©',
    'Last 30 days'                                           => 'æœ€è¿‘30å¤©',
    'Last month'                                             => 'ä¸Šæœˆ',
    'This month'                                             => 'æœ¬æœˆ',
    'Choose'                                                 => 'é€‰æ‹©',
    'Append'                                                 => 'è¿½åŠ ',
    'Upload'                                                 => 'ä¸Šä¼ ',
    'Memo'                                                   => 'å¤‡æ³¨',
    'Parent'                                                 => 'çˆ¶çº§',
    'Params'                                                 => 'å‚æ•°',
    'Permission'                                             => 'æƒé™',
    'Go back'                                                => 'è¿”å›ä¸Šä¸€é¡µ',
    'Jump now'                                               => 'ç«‹å³è·³è½¬',
    'Advance search'                                         => 'é«˜çº§æœç´¢',
    'Check all'                                              => 'é€‰ä¸­å…¨éƒ¨',
    'Expand all'                                             => 'å±•å¼€å…¨éƒ¨',
    'Begin time'                                             => 'å¼€å§‹æ—¶é—´',
    'End time'                                               => 'ç»“æŸæ—¶é—´',
    'Create time'                                            => 'åˆ›å»ºæ—¶é—´',
    'Flag'                                                   => 'æ ‡å¿—',
    'Gitee'                                                  => 'ç äº‘',
    'Github'                                                 => 'Github',
    'QQ group'                                               => 'QQç¾¤',
    'Member center'                                          => 'ä¼šå‘˜ä¸­å¿ƒ',
    'Copyrights'                                             => 'ç‰ˆæƒæ‰€æœ‰',
    'Responsive'                                             => 'å“åº”å¼å¼€å‘',
    'Languages'                                              => 'å¤šè¯­è¨€',
    'Module'                                                 => 'æ¨¡å—åŒ–å¼€å‘',
    'Extension'                                              => 'è‡ªç”±å¯æ‰©å±•',
    'Auth'                                                   => 'æƒé™ç®¡ç†',
    'The fastest framework based on ThinkPHP5 and Bootstrap' => 'åŸºäºThinkPHP5å’ŒBootstrapçš„æé€Ÿåå°å¼€å‘æ¡†æ¶',
    'Features'                                               => 'åŠŸèƒ½ç‰¹æ€§',
    'Home'                                                   => 'é¦–é¡µ',
    'Store'                                                  => 'æ’ä»¶å¸‚åœº',
    'Wxapp'                                                  => 'å°ç¨‹åº',
    'Services'                                               => 'æœåŠ¡',
    'Download'                                               => 'ä¸‹è½½',
    'Demo'                                                   => 'æ¼”ç¤º',
    'Donation'                                               => 'æèµ ',
    'Forum'                                                  => 'ç¤¾åŒº',
    'Docs'                                                   => 'æ–‡æ¡£',
    'User center'                                            => 'ä¼šå‘˜ä¸­å¿ƒ',
    'Change password'                                        => 'ä¿®æ”¹å¯†ç ',
    'Please login first'                                     => 'è¯·ç™»å½•åå†æ“ä½œ',
    'Uploaded successful'                                    => 'ä¸Šä¼ æˆåŠŸ',
    'You can upload up to %d file%s'                         => 'ä½ æœ€å¤šè¿˜å¯ä»¥ä¸Šä¼ %dä¸ªæ–‡ä»¶',
    'You can choose up to %d file%s'                         => 'ä½ æœ€å¤šè¿˜å¯ä»¥é€‰æ‹©%dä¸ªæ–‡ä»¶',
    'Chunk file write error'                                 => 'åˆ†ç‰‡å†™å…¥å¤±è´¥',
    'Chunk file info error'                                  => 'åˆ†ç‰‡æ–‡ä»¶é”™è¯¯',
    'Chunk file merge error'                                 => 'åˆ†ç‰‡åˆå¹¶é”™è¯¯',
    'Chunk file disabled'                                    => 'æœªå¼€å¯åˆ†ç‰‡ä¸Šä¼ åŠŸèƒ½',
    'Cancel upload'                                          => 'å–æ¶ˆä¸Šä¼ ',
    'Upload canceled'                                        => 'ä¸Šä¼ å·²å–æ¶ˆ',
    'No file upload or server upload limit exceeded'         => 'æœªä¸Šä¼ æ–‡ä»¶æˆ–è¶…å‡ºæœåŠ¡å™¨ä¸Šä¼ é™åˆ¶',
    'Uploaded file format is limited'                        => 'ä¸Šä¼ æ–‡ä»¶æ ¼å¼å—é™åˆ¶',
    'Uploaded file is not a valid image'                     => 'ä¸Šä¼ æ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶',
    'Are you sure you want to cancel this upload?'           => 'ç¡®å®šå–æ¶ˆä¸Šä¼ ï¼Ÿ',
    'Remove file'                                            => 'ç§»é™¤æ–‡ä»¶',
    'You can only upload a maximum of %s files'              => 'ä½ æœ€å¤šå…è®¸ä¸Šä¼  %s ä¸ªæ–‡ä»¶',
    'You can\'t upload files of this type'                   => 'ä¸å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹',
    'Server responded with %s code'                          => 'æœåŠ¡ç«¯å“åº”(Code:%s)',
    'File is too big (%sMiB), Max filesize: %sMiB'           => 'å½“å‰ä¸Šä¼ (%sM)ï¼Œæœ€å¤§å…è®¸ä¸Šä¼ æ–‡ä»¶å¤§å°:%sM',
    'Send verification code'                                 => 'å‘é€éªŒè¯ç ',
    'Redirect now'                                           => 'ç«‹å³è·³è½¬',
    'Operation completed'                                    => 'æ“ä½œæˆåŠŸ!',
    'Operation failed'                                       => 'æ“ä½œå¤±è´¥!',
    'Unknown data format'                                    => 'æœªçŸ¥çš„æ•°æ®æ ¼å¼!',
    'Network error'                                          => 'ç½‘ç»œé”™è¯¯!',
    'Advanced search'                                        => 'é«˜çº§æœç´¢',
    'Invalid parameters'                                     => 'æœªçŸ¥å‚æ•°',
    'No results were found'                                  => 'è®°å½•æœªæ‰¾åˆ°',
    'Parameter %s can not be empty'                          => 'å‚æ•°%sä¸èƒ½ä¸ºç©º',
    'Token verification error'                               => 'TokenéªŒè¯é”™è¯¯ï¼',
    'You have no permission'                                 => 'ä½ æ²¡æœ‰æƒé™è®¿é—®',
    'An unexpected error occurred'                           => 'å‘ç”Ÿäº†ä¸€ä¸ªæ„å¤–é”™è¯¯,ç¨‹åºçŒ¿æ­£åœ¨ç´§æ€¥å¤„ç†ä¸­',
    'This page will be re-directed in %s seconds'            => 'é¡µé¢å°†åœ¨ %s ç§’åè‡ªåŠ¨è·³è½¬',
];

```
:::
## âœ¨æ³¨å†ŒåŠŸèƒ½

```php
    /** 
     * æ³¨å†Œ
     */
    public function register()
    {
        if ($this->request->isPost()) {
            $mobile = $this->request->param('mobile', '', 'trim');
            $password = $this->request->param('password', '', 'trim');

            if (empty($password)) {
                $this->error('å¯†ç ä¸èƒ½ä¸ºç©º');
            }
            /** ç”Ÿæˆå¯†ç ç› */
            $salt = build_ranstr();
            /** md5å¯†ç  */
            $password = md5($password . $salt);
            // ç»„è£…æ³¨å†Œçš„æ•°æ®
            $data = [
                'mobile' => $mobile,
                'password' => $password,
                'salt' => $salt
            ];
            $result = $this->BusinessModel->validate('common/business/Business.register')->save($data);
            if ($result === false) {
                $this->error($this->BusinessModel->getError());
            } else {
                $this->success('æ³¨å†ŒæˆåŠŸ', url('/home/index/login'));
            }
        }
        return $this->fetch();
    }
```





