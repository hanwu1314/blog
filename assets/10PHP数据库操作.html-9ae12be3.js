import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,e as p}from"./app-2c84a828.js";const t={},e=p(`<h2 id="简单连接" tabindex="-1"><a class="header-anchor" href="#简单连接" aria-hidden="true">#</a> 简单连接</h2><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">pdo_edu</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">PDO</span><span class="token punctuation">;</span>

<span class="token comment">// 1. php连接数据库</span>
<span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;root&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;root&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$dsn</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;mysql:host=localhost;dbname=phpedu;port=3306;charset=utf8&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token variable">$dsn</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token punctuation">)</span> <span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;连接成功&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;连接失败&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="封装连接" tabindex="-1"><a class="header-anchor" href="#封装连接" aria-hidden="true">#</a> 封装连接</h2><p><code>config/database.php</code></p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">pdo_deu</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token comment">// dsn</span>
    <span class="token string single-quoted-string">&#39;type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;mysql&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;host&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;dbname&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;phpedu&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;port&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;3306&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;charset&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;utf8&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">// username</span>
    <span class="token string single-quoted-string">&#39;username&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;root&#39;</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;password&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;root&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>config/connect.php</code></p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">pdo_edu</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">PDO</span><span class="token punctuation">;</span>

<span class="token variable">$dbConfig</span> <span class="token operator">=</span> <span class="token keyword">require</span> <span class="token string single-quoted-string">&#39;database.php&#39;</span><span class="token punctuation">;</span>
<span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$dbConfig</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将变量从数组导入当前符号表</span>

<span class="token comment">// 1. 创建数据源</span>
<span class="token variable">$tpl</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;%s:host=%s;dbname=%s;port=%s;charset=%s&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$args</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$host</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">,</span> <span class="token variable">$charset</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$dsn</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token variable">$tpl</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回格式化的字符串</span>

<span class="token comment">// 2. 创建数据对象</span>
<span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token variable">$dsn</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置结果集的默认获取模式：只要关联部分</span>
<span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">ATTR_DEFAULT_FETCH_MODE</span><span class="token punctuation">,</span> <span class="token class-name static-context">PDO</span><span class="token operator">::</span><span class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="增删改查" tabindex="-1"><a class="header-anchor" href="#增删改查" aria-hidden="true">#</a> 增删改查</h2><p>PDO预处理<br> 为什么要用预处理?</p><ol><li>防止SQL注入攻击, 2. 数据延迟绑定<br> (编程时只写SQL语句模板,执行SQL时再给占位符绑定真实数据)<br> 预处理过程:</li><li>创建SQL语句模板对象: 数据使用占位符表示</li><li>执行SQL语句,根据操作类型(写/读),读返回结果集/数组, 写返回受影响的记录数量</li></ol><h3 id="insert-插入" tabindex="-1"><a class="header-anchor" href="#insert-插入" aria-hidden="true">#</a> INSERT 插入</h3><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;INSERT \`staff\` SET \`name\` = ?, \`sex\` = ?, \`email\` = ?&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;小龙女&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;xiaolongnv@php.cn&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;洪七公&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;hongqigong@php.cn&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//rowCount 返回受影响的记录数量</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;新增成功, 新增记录的主键ID = &#39;</span> <span class="token operator">.</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">lastInsertId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;新增失败&#39;</span><span class="token punctuation">;</span>
    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">errorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="update-更新" tabindex="-1"><a class="header-anchor" href="#update-更新" aria-hidden="true">#</a> UPDATE 更新</h3><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token comment">// UPDATE 表名 SET 字段1=值1 ... WHERE 更新条件</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;UPDATE \`staff\` SET \`name\` = ? WHERE \`id\` = ?&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;老顽童&#39;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;更新成功&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;更新失败&#39;</span><span class="token punctuation">;</span>
    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">errorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="delete-删除" tabindex="-1"><a class="header-anchor" href="#delete-删除" aria-hidden="true">#</a> DELETE 删除</h3><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token comment">// DELETE FROM 表名 SET 字段1=值1 ... WHERE 更新条件  </span>
<span class="token comment">// $sql = &#39;DELETE FROM \`staff\` WHERE \`id\` = ? &#39;;  </span>
<span class="token comment">// &#39;?&#39; : 匿名占位符  </span>
<span class="token comment">// &#39;string&#39;: 命名占位符  </span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;DELETE FROM \`staff\` WHERE \`id\` = :id&#39;</span><span class="token punctuation">;</span>  
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;:id&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// 如果条件来自外部， 例如 url 中 get 参数  </span>
<span class="token comment">// echo $_GET[&#39;id&#39;];  </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
<span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;id = &#39;</span> <span class="token operator">.</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39; 删除成功&#39;</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
<span class="token keyword">echo</span> <span class="token string single-quoted-string">&#39;删除失败&#39;</span><span class="token punctuation">;</span>  
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">errorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询" tabindex="-1"><a class="header-anchor" href="#查询" aria-hidden="true">#</a> 查询</h3><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;SELECT \`id\`,\`name\` FROM \`staff\` WHERE \`id\` &lt; :id&#39;</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// PDO::FETCH_ASSOC: 结果集获取模式，只返回关联部分</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$staff</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;&lt;pre&gt;%s&lt;/pre&gt;&#39;</span><span class="token punctuation">,</span> <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$staff</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">php_edu</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">PDO</span><span class="token punctuation">;</span>
<span class="token comment">// 1. 连接数据库</span>
<span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;/config/connect.php&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// 2. CURD: SELECT 多条查询</span>
<span class="token comment">// SELECT 字段列表 FROM 表名 WHERE 查询条件</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;SELECT \`id\`,\`name\` FROM \`staff\` WHERE \`id\` &gt; :id&#39;</span><span class="token punctuation">;</span>

<span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;id&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fetchAll: 返回全部满足条件的记录集合，二维数组</span>
<span class="token variable">$staffs</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token operator">-&gt;</span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// print_r($staffs);</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$staffs</span> <span class="token keyword">as</span> <span class="token variable">$staff</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;&lt;pre&gt;%s&lt;/pre&gt;&#39;</span><span class="token punctuation">,</span> <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$staff</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,19),o=[e];function c(l,i){return s(),a("div",null,o)}const k=n(t,[["render",c],["__file","10PHP数据库操作.html.vue"]]);export{k as default};
